"use strict";function diServerDirective(e){return{restrict:"EA",scope:{endpoint:"@",cors:"@"},link:function(t,o,i){e.configure(i.endpoint,i.cors,i.auth)}}}function diRScriptDirective(e){return{restrict:"E",scope:{name:"@",author:"@",directory:"@",inputs:"@",outputs:"@",es:"@",onload:"@"},compile:function(){return{pre:function(t,o,i){e.registarScript({name:i.name,author:i.author,directory:i.directory,inputs:i.inputs,outputs:i.outputs,es:i.es,onload:i.onload})}}}}}function diRCodeDirective(e){return{restrict:"E",scope:{name:"@",author:"@",directory:"@",inputs:"@",outputs:"@",es:"@",onload:"@"},compile:function(){return{pre:function(t,o,i){var r=o.html(),n=function(e){return e.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt/g,">;")};o.empty(),e.registarCode({name:i.name,inputs:i.inputs,outputs:i.outputs,es:i.es,onload:i.onload,block:n(r)})}}}}}function diInputDirective(e,t,o){return{restrict:"E",scope:{label:"@",placeholder:"@",rtype:"@",rinput:"@",rscript:"@"},link:function(e,i,r){var n=r.rscript,c=r.rinput,l=t("<md-input-container><label>"+r.label+'</label><input ng-model="rscript.'+n+".inputs."+c+'" placeholder=""></md-input-container>');"true"===r.watch&&o.rscript[n].watches.push(c),o.rscript[n].rtypes[c]=r.rtype,i.append(l(o))}}}function diSliderDirective(e,t,o,i){return{restrict:"E",scope:{value:"@",max:"@",min:"@",rtype:"@",rinput:"@",rscript:"@"},link:function(r,n,c){var l,s,a=c.rscript||c.rcode,u=c.rinput,d=c.min||0,p=c.max||100,g=c.value||0,m=c.step||1,f=c.rscript?"rscript":"rcode";o[f][a].inputs[u]=g,o[f][a].rtypes[u]=c.rtype,s=t('<md-slider flex min="'+d+'" max="'+p+'"ng-model="'+f+"."+a+".inputs."+u+'"id="red-slider" aria-label="red" md-discrete class step="'+m+'"></md-slider>'),n.append(s(o)),"true"===c.watch&&o.$watch(f+"."+a+".inputs."+u,function(t,r){t!==r&&(i.cancel(l),l=i(function(){e.exe(o[f][a])},c.debounce||500))},!0)}}}function diCheckboxDirective(e,t,o){return{restrict:"E",transclude:!1,scope:{value:"@",rtype:"@",rinput:"@",rscript:"@"},link:function(e,i,r){var n=r.rscript,c=r.rinput,l="true"===r.value?!0:!1,s=angular.element(i);"true"===r.watch&&o.rscript[n].watches.push(c),o.rscript[n].inputs[c]=l,o.rscript[n].rtypes[c]=r.rtype;var a='<md-checkbox ng-model="rscript.'+n+".inputs."+c+'">'+i.html()+"</md-checkbox>";s.empty(),s.append(t(a)(o))}}}function diSelectDirective(e,t,o){return{restrict:"E",scope:{placeholder:"@",label:"@",selected:"@",watch:"@",rtype:"@",rinput:"@",rscript:"@"},link:function(e,i,r){var n=r.rscript,c=r.rinput,l=r.selected,s=r.placeholder||"",a=r.label?'<p style="margin-bottom:5px;">'+r.label+"</p>":"",u=angular.element(i);if(l)switch(r.rtype){case"numeric":l=parseFloat(l);break;case"integer":l=parseInt(l);break;case"logical":l="true"===l?!0:!1}"true"===r.watch&&o.rscript[n].watches.push(c),o.rscript[n].inputs[c]=l,o.rscript[n].rtypes[c]=r.rtype;var d=a+"<md-select"+(r.label?' style="margin-top:0px;"':"")+' placeholder="'+s+'" ng-model="rscript.'+n+".inputs."+c+'">'+i.html().replace(/di-/gi,"md-")+"</md-select>";u.empty(),u.append(t(d)(o))}}}function diPlotDirective(e,t,o){return{restrict:"E",scope:{height:"@",width:"@",routput:"@",rscript:"@"},link:function(e,i,r){var n=r.rscript,c=r.routput,l=r.height,s=(r.width,angular.element(i)),a='<img ng-src="{{rscript.'+n+".outputs."+c+'}}" height="'+l+'"/>';s.empty(),s.append(t(a)(o))}}}function diToastDirective(e,t,o,i){return{restrict:"E",scope:{es:"@",routput:"@",rscript:"@",hideDelay:"@"},link:function(e,t,r){var n=r.rscript||r.rcode,c=r.rscript?"rscript":"rcode";r.es&&o.$watch(c+"."+n+".es."+r.es,function(e,t){e!==t&&i.show(i.simple().content(e))},!0),r.routput&&o.$watch(c+"."+n+".es."+r.routput,function(e,t){e!==t&&i.show(i.simple().content(e).hideDelay(r.hideDelay||3e3))},!0)}}}function diTableDirective(){return{restrict:"E",scope:{headers:"=",content:"=",sortable:"=",filters:"=",customClass:"=customClass",thumbs:"=",count:"="},controller:["$scope","$filter",function(e,t){var o=t("orderBy");e.tablePage=0,e.nbOfPages=function(){return Math.ceil(e.content.length/e.count)},e.handleSort=function(t){return e.sortable.indexOf(t)>-1?!0:!1},e.order=function(t,i){e.content=o(e.content,t,i),e.predicate=t},e.order(e.sortable[0],!1),e.getNumber=function(e){return new Array(e)},e.goToPage=function(t){e.tablePage=t}}],template:angular.element(document.querySelector("#di-table-template")).html()}}function diColresizeDirective(e){return{restrict:"A",link:function(t){t.$evalAsync(function(){e(function(){},100)})}}}var app=angular.module("deployrUi.directives",["deployrUi"]);diServerDirective.$inject=["$deployr"],diRScriptDirective.$inject=["$deployr"],diRCodeDirective.$inject=["$deployr"],diInputDirective.$inject=["$deployr","$compile","$rootScope"],diSliderDirective.$inject=["$deployr","$compile","$rootScope","$timeout"],diCheckboxDirective.$inject=["$deployr","$compile","$rootScope"],diSelectDirective.$inject=["$deployr","$compile","$rootScope"],diPlotDirective.$inject=["$deployr","$compile","$rootScope"],diToastDirective.$inject=["$deployr","$compile","$rootScope","$mdToast"],diTableDirective.$inject=["$deployr"],diColresizeDirective.$inject=["$timeout"],app.directive("diServer",diServerDirective).directive("diRscript",diRScriptDirective).directive("diRcode",diRCodeDirective).directive("diInput",diInputDirective).directive("diSlider",diSliderDirective).directive("diCheckbox",diCheckboxDirective).directive("diSelect",diSelectDirective).directive("diPlot",diPlotDirective).directive("diToast",diToastDirective).directive("diTable",diTableDirective).directive("diColresize",diColresizeDirective),angular.module("deployrUi",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngMaterial","ui.router","deployrUi.directives","deployrUi.core"]),angular.module("deployrUi").controller("NavbarCtrl",["$scope",function(e){e.date=new Date}]),angular.module("deployrUi").controller("LoginCtrl",["$rootScope","$scope","$deployr","$state",function(e,t,o,i){!o.validEndpoint(),t.user={username:"",password:""},t.progress=!1,t.login=function(){t.progress=!0,o.login(t.user.username,t.user.password).then(function(t){e.currentUser=t.get("user"),o.es(),i.go("content")},function(e){t.$apply(function(){t.error=e})}).ensure(function(){e.authenticating=!1,t.progress=!1})}}]),angular.module("deployrUi").controller("ContentCtrl",["$rootScope","$scope","$deployr",function(e,t,o){t.logout=function(){o.logout()}}]),function(){function e(e,t,o){function i(e,o){var i=Object.keys(t.rscript[e].outputs),r=[];o.get("artifacts")&&o.get("artifacts").forEach(function(o){-1!=i.indexOf(o.filename)&&(t.rscript[e].outputs[o.filename]=o.url,r.push(o.filename))}),i.forEach(function(i){var n=o.workspace(i);n&&(t.rscript[e].outputs[n.name]=n.value,r.push(n.name))}),o.get("results")&&o.get("results").forEach(function(o){for(var i in t.rscript[e].outputs)-1===r.indexOf(i)&&(t.rscript[e].outputs[i]=o.url,r.push(i))}),t.$apply()}function r(e,o){var i=Object.keys(t.rcode[e].outputs),r=[];o.get("artifacts")&&o.get("artifacts").forEach(function(o){-1!=i.indexOf(o.filename)&&(t.rcode[e].outputs[o.filename]=o.url,r.push(o.filename))}),i.forEach(function(i){var n=o.workspace(i);n&&(t.rcode[e].outputs[n.name]=n.value,r.push(n.name))}),o.get("results")&&o.get("results").forEach(function(o){for(var i in t.rcode[e].outputs)-1===r.indexOf(i)&&(t.rcode[e].outputs[i]=o.url,r.push(i))}),t.$apply()}function n(e){a=a.io("/r/repository/script/execute"),a.data(e.data);for(var t in e.inputs)try{a[e.rtypes[t]](t,e.inputs[t])}catch(r){}a.routputs(Object.keys(e.outputs)).on("deployr-io:401",function(){o.go("login")}).error(function(e){console.log(e)}).end(function(t){i(e.id,t)})}function c(e){a=a.code(e.block,e.pid).data({enableConsoleEvents:!0});for(var t in e.inputs)try{a[e.rtypes[t]](t,e.inputs[t])}catch(i){}a.routputs(Object.keys(e.outputs)).on("deployr-io:401",function(){o.go("login")}).error(function(e){console.log(e)}).end(function(t){return r(e.id,t),{project:t.get("project").project}}).io("/r/project/close").end()}var l=e.deployr,s={},a=l;return t.rscript={},t.rcode={},{validEndpoint:function(){return s.cors&&s.endpoint||!s.cors},configure:function(e,i,r){s={host:e,cors:i},l.configure(s),t.authenticating=!0,t.auth=r,r&&"undefined"==typeof t.currentUser&&(a=a.io("/r/user/about").on("deployr-io:401",function(){o.go("login")}).end(this.es))},registarScript:function(e){var o=e.name;o=o.slice(0,-2);var i={},r={};(e.inputs||[]).split(",").forEach(function(e){i[e]="",r[e]={name:e,type:null}});var c={};(e.outputs||[]).split(",").forEach(function(e){c[e]=""});var l={};(e.es||[]).split(",").forEach(function(e){l[e]=""}),t.rscript[o]={id:o,watches:[],onload:e.onload||!1,inputs:i,outputs:c,es:l,rtypes:r,data:{author:e.author,directory:e.directory||"root",filename:e.name,enableConsoleEvents:!0}},t.$watch("rscript."+o+".inputs",function(e,i){for(var r in e)e[r]!==i[r]&&-1!=t.rscript[o].watches.indexOf(r)&&n(t.rscript[o]);t.rscript[o].onload&&(t.rscript[o].onload=!1,n(t.rscript[o]))},!0)},registarCode:function(e){var o=e.name;o=o.slice(0,-2);var i={},r={};(e.inputs||[]).split(",").forEach(function(e){i[e]="",r[e]={name:e,type:null}});var n={};(e.es||[]).split(",").forEach(function(e){n[e]=""});var l={};(e.outputs||[]).split(",").forEach(function(e){l[e]=""}),t.rcode[o]={id:o,watches:[],onload:e.onload||!1,inputs:i,es:n,outputs:l,rtypes:r,block:e.block},t.$watch("rcode."+o+".inputs",function(e,i){for(var r in e)e[r]!==i[r]&&-1!=t.rcode[o].watches.indexOf(r)&&c(t.rcode[o]);t.rcode[o].onload&&(t.rcode[o].onload=!1,c(t.rcode[o]))},!0)},exe:function(e){t.authenticating=!1,e.block?c(e):n(e)},es:function(){function e(e){console.log("-----------"),console.log(e),console.log("-----------")}t.$apply(function(){console.log("FALSE....."),t.authenticating=!1});l.es().on("es:error",function(t){console.log("==================="),console.log("es:error"),console.log("==================="),e(t)}).on("es:connecting",function(t){console.log("==================="),console.log("es:connecting"),console.log("==================="),e(t)}).on("es:disconnect",function(t){console.log("==================="),console.log("es:disconnect"),console.log("==================="),e(t)}).on("es:streamConnect",function(t){console.log("==================="),console.log("es:streamConnect"),console.log("==================="),e(t)}).on("es:streamDisconnect",function(t){console.log("==================="),console.log("es:streamDisconnect"),console.log("==================="),e(t)}).on("es:executionRevo",function(o){console.log("==================="),console.log("es:executionRevo"),console.log("==================="),e(o);var i=o.deployr.response.event.object;if(i){for(var r in t.rscript)t.rscript[r].es[i.name]=i.value;for(var n in t.rcode)t.rcode[n].es[i.name]=i.value;t.$apply()}}).on("es:executionError",function(t){console.log("==================="),console.log("es:executionError"),console.log("==================="),e(t)}).on("es:jobLifecycle",function(t){console.log("==================="),console.log("es:jobLifecycle"),console.log("==================="),e(t)}).on("es:gridHeartbeat",function(t){console.log("==================="),console.log("es:gridHeartbeat"),console.log("==================="),e(t)}).on("es:gridActivity",function(t){console.log("==================="),console.log("es:gridActivity"),console.log("==================="),e(t)}).on("es:gridWarning",function(t){console.log("==================="),console.log("es:gridWarning"),console.log("==================="),e(t)}).on("es:securityLogin",function(t){console.log("==================="),console.log("es:securityLogin"),console.log("==================="),e(t)}).on("es:securityLogout",function(t){console.log("==================="),console.log("es:securityLogout"),console.log("==================="),e(t)}).open().flush()},logout:function(){l.io("/r/user/logout").end()},login:function(e,t){return a=l.io("/r/user/login").data({username:e,password:t}),a.promise()}}}angular.module("deployrUi.core",[]).service("$deployr",e),e.$inject=["$window","$rootScope","$state","$q"]}(),angular.module("deployrUi").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("content",{url:"/",templateUrl:"app/components/content/content.html",data:{requireLogin:!0}}).state("login",{url:"/login",templateUrl:"app/components/login/login.html",data:{requireLogin:!1}})}]).controller("MainCtrl",["$scope",function(){}]).filter("startFrom",function(){return function(e,t){return t=+t,e.slice(t)}}).run(["$rootScope","$state",function(e,t){e.$on("$stateChangeStart",function(o,i){var r=i.data.requireLogin;e.auth&&r&&"undefined"==typeof e.currentUser&&(o.preventDefault(),t.go("login"))})}]),angular.module("deployrUi").run(["$templateCache",function(e){e.put("app/ui/ui.html",'<div di-server="" endpoint="http://deployr-7.4.x-trunk.deployr.co:7400" cors="true" auth="true"><di-rscript name="faithful.R" author="swells" directory="faithful" inputs="n_breaks,individual_obs,density,bw_adjust" outputs="plot" es="df" onload="true"></di-rscript><di-select placeholder="20" rscript="faithful" rinput="n_breaks" rtype="numeric" label="Number of bins in histogram (approximate):" watch="true" selected="50"><di-option value="10">10</di-option><di-option value="20">20</di-option><di-option value="35">35</di-option><di-option value="50">50</di-option></di-select><di-checkbox rscript="faithful" rinput="individual_obs" rtype="logical" watch="true">Show individual observations</di-checkbox><di-checkbox rscript="faithful" rinput="density" rtype="logical" watch="true">Show density estimate</di-checkbox><di-plot rscript="faithful" routput="plot"></di-plot><di-slider ng-show="rscript.faithful.inputs.density" rscript="faithful" rinput="bw_adjust" rtype="numeric" watch="true" min="0.2" max="2" value="1" step="0.2"></di-slider></div>'),e.put("app/components/content/code.html",'<div di-server="" endpoint="http://23.253.163.150:7400" cors="true" auth="true"><di-rcode name="myBC.R" inputs="x" outputs="label,y" onload="true">label<- "hello="" from="" the="" r="" code!"="" revoevent(x)="" y<-rnorm(x)="" <="" di-rcode=""><h1>{{ rcode.myBC.outputs.label }}</h1><h1>{{ rcode.myBC.outputs.y }}</h1><di-slider rcode="myBC" rinput="x" rtype="numeric" watch="true" max="2" value="1" step="0.2" min="0.2"></di-slider></-></di-rcode></div>'),e.put("app/components/content/content.html",'<div ng-controller="ContentCtrl"><div layout="row" style="margin: 25px; padding:25px"><div flex=""><div ng-include="\'app/ui/ui.html\'"></div></div></div></div>'),e.put("app/components/content/default.html",'<div di-server="" endpoint="http://deployr-7.4.x-trunk.deployr.co:7400" cors="true" auth="false"><di-rscript name="myScript.R" author="swells" directory="root" inputs="n_breaks,individual_obs,density,bw_adjust" outputs="plot" es="df" onload="true"></di-rscript><di-select placeholder="20" rscript="myScript" rinput="n_breaks" rtype="numeric" label="Number of bins in histogram (approximate):" watch="true" selected="50"><di-option value="10">10</di-option><di-option value="20">20</di-option><di-option value="35">35</di-option><di-option value="50">50</di-option></di-select><di-checkbox rscript="myScript" rinput="individual_obs" rtype="logical" watch="true">Show individual observations</di-checkbox><di-checkbox rscript="myScript" rinput="density" rtype="logical" watch="true">Show density estimate</di-checkbox><di-plot rscript="myScript" routput="plot"></di-plot><di-slider ng-show="rscript.myScript.inputs.density" rscript="myScript" rinput="bw_adjust" rtype="numeric" watch="true" min="0.2" max="2" value="1" step="0.2"></di-slider><di-toast rscript="myScript" es="df" hidedelay="1000"></di-toast><button ng-click="logout()">Logout</button></div>'),e.put("app/components/content/dt.html",'<div layout="column"><div class="main-fab"><md-button class="md-fab md-accent">+</md-button></div><md-toolbar layout="column" class="md-small"><span flex="flex"></span><div class="md-toolbar-tools"><div layout="row" flex="flex" class="fill-height"><div ng-hide="toggleSearch" class="md-toolbar-item md-breadcrumb"><span>Angular Material Table</span></div><span flex="flex" ng-hide="toggleSearch"></span><md-input-container flex="flex" style="padding-left:88px;" ng-show="toggleSearch"><input type="text" ng-model="search"></md-input-container><div layout="row" class="md-toolbar-item md-tools"><a href="href" ng-click="toggleSearch = !toggleSearch" class="md-button md-default-theme"><i class="ion-android-search"></i></a></div></div></div></md-toolbar><md-content layout="column" flex="flex" ng-click="toggleSearch=false"><di-table headers="headers" content="content" sortable="sortable" filters="search" custom-class="custom" thumbs="thumbs" count="count"></di-table></md-content><template id="di-table-template"><table di-colresize="di-colresize" class="di-table"><thead><tr class="di-table-headers-row"><th ng-repeat="h in headers" class="di-table-header"><a href="#" ng-if="handleSort(h.field)" ng-click="reverse=!reverse;order(h.field,reverse)">{{h.name}} <i ng-show="reverse &amp;&amp; h.field == predicate" class="ion-android-arrow-dropup"></i><i ng-show="!reverse &amp;&amp; h.field == predicate" class="ion-android-arrow-dropdown"></i></a><span ng-if="!handleSort(h.field)">{{h.name}}</span></th><th class="di-table-header"></th></tr></thead><tbody><tr ng-repeat="c in content | filter:filters | startFrom:tablePage*count | limitTo: count" class="di-table-content-row"><td><div ng-repeat="h in headers" ng-if="h.field == thumbs" class="di-table-thumbs"><div style="background-image:url({{c.thumb}})"></div></div></td><td ng-repeat="h in headers" ng-class="customClass[h.field]" ng-if="h.field != thumbs" class="di-table-content">{{(h.field.indexOf(\'date\') > 0) ? $filter(\'date\')(c[h.field]) : c[h.field];}}</td><td class="di-table-td-more"><md-button aria-label="Info"><i class="ion-android-more-vertical"></i></md-button></td></tr></tbody></table><div layout="row" class="di-table-footer"><span class="di-table-count-info">Rows per page : <a href="#" ng-click="goToPage(0); count=10">10</a>,<a href="#" ng-click="goToPage(0); count=25">25</a>,<a href="#" ng-click="goToPage(0); count=50">50</a>,<a href="#" ng-click="goToPage(0); count=100">100</a>(current is {{count}})</span><span flex="flex"></span><span ng-show="nbOfPages() &gt; 1"><md-button ng-disabled="tablePage==0" ng-click="tablePage=tablePage-1" aria-label="Previous Page" class="md-primary md-hue-2"><i style="font-size:16px;" class="ion-chevron-left"></i></md-button><a href="#" ng-repeat="i in getNumber(nbOfPages()) track by $index"><md-button ng-click="goToPage($index)" class="md-primary md-hue-2 di-table-footer-item"><span ng-class="{ \'di-table-active-page\': tablePage==$index}">{{$index+1}}</span></md-button></a><md-button ng-disabled="tablePage==nbOfPages()-1" ng-click="tablePage=tablePage+1" aria-label="Next Page" class="md-primary md-hue-2"><i style="font-size:16px;" class="ion-chevron-right"></i></md-button></span></div></template></div>'),e.put("app/components/content/view.html",'<div di-server="" endpoint="http://deployr-7.4.x-trunk.deployr.co:7400" cors="true"><section class="jumbotron"><h1>\'R <small>♥</small> JavaScript\'</h1><p class="lead"><img src="assets/images/spec.png" alt="I\'m a Spectacle"><br>Always a pleasure scaffolding your DeployR apps.</p></section></div>'),e.put("app/components/login/login.html",'<md-content ng-controller="LoginCtrl" class="login"><hgroup><h1>Sign into App</h1><h3>DeployR</h3></hgroup><form name="loginForm" autocomplete="off"><div ng-show="error" class="message-error">The username or password you entered is incorrect.</div><div><md-input-container flex=""><label>Username</label> <input ng-model="user.username" type="text" name="un"></md-input-container></div><input style="display:none" type="text" name="fakeusernameremembered"> <input style="display:none" type="password" name="fakepasswordremembered"><div class="group"><md-input-container flex=""><label>Password</label> <input ng-model="user.password" type="password" name="pw"></md-input-container></div><button ng-disabled="progress" type="submit" class="button buttonBlue" ng-click="login()">Sign in<div class="ripples buttonRipples"><span class="ripplesCircle"></span></div></button></form></md-content>'),e.put("app/components/navbar/navbar.html",'<md-toolbar class="md-default-theme" layout="row" layout-align="center center" ng-controller="NavbarCtrl"><md-button href="https://github.com/Swiip/generator-gulp-angular">DeployR</md-button><md-button href="#">Current date: {{ date | date:\'yyyy-MM-dd\' }}</md-button></md-toolbar>')}]);